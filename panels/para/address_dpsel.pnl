V 14
4
LANG:10001 8 (NoName)
LANG:10004 11 (未命名)
LANG:10000 8 (NoName)
LANG:10027 18 (БезИмени)
PANEL,-1 -1 686 257 N "_3DFace" 0
E E E E E 1 -1 -1 0  50 72
""0  1
E E 4
"CBRef" "0"
"EClose" E
"dpi" "96"
"pdpi" "96"
0 0 0
""
DISPLAY_LAYER, 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0
LAYER, 0 
4
LANG:10001 6 Layer1
LANG:10004 6 Layer1
LANG:10000 6 Layer1
LANG:10027 6 Layer1
2 43
"Text2"
""
1 57 95 E E E 1 E 1 E N "_3DText" E N "_3DFace" E E
 E E
42 0 0 0 0 0
E E E
0
3
LANG:10000 0 
LANG:10001 0 
LANG:10027 0 

4
"sizePolicy" "Fixed Fixed"
"layoutAlignment" "AlignCenter"
"dashclr"N "_Transparent"
"antiAliased" "0"
E E 0 1 1 0 1 E U  1 E 27 13 146 27
0 2 0 "0s" 0 0 0 192 0 0  27 13 1
4
LANG:10001 26 Arial,-1,13,5,50,0,0,0,0,0
LANG:10004 26 Arial,-1,13,5,50,0,0,0,0,0
LANG:10000 26 Arial,-1,13,5,50,0,0,0,0,0
LANG:10027 26 arial,-1,13,5,50,0,0,0,0,0
0 4
LANG:10001 16 Available slaves
LANG:10004 12 可用从站
LANG:10000 18 Vorhandene Slaves 
LANG:10027 35 Ведомые устройства
2 44
"Text4"
""
1 234 211 E E E 1 E 1 E N "_3DText" E N "_3DFace" E E
 E E
43 0 0 0 0 0
E E E
0
3
LANG:10000 0 
LANG:10001 0 
LANG:10027 0 

4
"sizePolicy" "Fixed Fixed"
"layoutAlignment" "AlignCenter"
"dashclr"N "_Transparent"
"antiAliased" "0"
E E 0 1 1 0 1 E U  1 E 177 13 222 27
0 2 0 "0s" 0 0 0 192 0 0  177 13 1
4
LANG:10001 26 Arial,-1,13,5,50,0,0,0,0,0
LANG:10004 26 Arial,-1,13,5,50,0,0,0,0,0
LANG:10000 26 Arial,-1,13,5,50,0,0,0,0,0
LANG:10027 26 arial,-1,13,5,50,0,0,0,0,0
0 4
LANG:10001 7 Modules
LANG:10004 6 模块
LANG:10000 6 Module
LANG:10027 12 Модули
2 46
"Text1"
""
1 730 253 E E E 1 E 1 E N "_3DText" E N "_3DFace" E E
 E E
44 0 0 0 0 0
E E E
0
3
LANG:10000 0 
LANG:10001 0 
LANG:10027 0 

4
"sizePolicy" "Fixed Fixed"
"layoutAlignment" "AlignCenter"
"dashclr"N "_Transparent"
"antiAliased" "0"
E E 0 1 1 0 1 E U  1 E 493 13 530 27
0 2 0 "0s" 0 0 0 192 0 0  493 13 1
4
LANG:10001 26 Arial,-1,13,5,50,0,0,0,0,0
LANG:10004 26 Arial,-1,13,5,50,0,0,0,0,0
LANG:10000 26 Arial,-1,13,5,50,0,0,0,0,0
LANG:10027 26 arial,-1,13,5,50,0,0,0,0,0
0 4
LANG:10001 4 Data
LANG:10004 12 查询结果
LANG:10000 5 Daten
LANG:10027 12 Данные
2 47
"AllMod"
""
1 30 211 E E E 1 E 0 E N {0,0,0} E N {255,255,255} E E
 E E
45 0 0 0 0 0
E E E
0
3
LANG:10000 0 
LANG:10001 0 
LANG:10027 0 

4
"sizePolicy" "Fixed Fixed"
"layoutAlignment" "AlignCenter"
"dashclr"N "_Transparent"
"antiAliased" "0"
E E 0 1 1 0 1 E U  1 E 32 213 98 229
1 2 0 "0s" 0 0 0 64 0 0  32 213 1
4
LANG:10001 32 Courier New,-1,12,5,50,0,0,0,0,0
LANG:10004 32 Courier New,-1,12,5,50,0,0,0,0,0
LANG:10000 32 Courier New,-1,12,5,50,0,0,0,0,0
LANG:10027 32 Courier New,-1,12,5,50,0,0,0,0,0
0 4
LANG:10001 0 
LANG:10004 0 
LANG:10000 0 
LANG:10027 0 
2 48
"SelMod"
""
1 760 231 E E E 1 E 0 E N {0,0,0} E N {255,255,255} E E
 E E
46 0 0 0 0 0
E E E
0
3
LANG:10000 0 
LANG:10001 0 
LANG:10027 0 

4
"sizePolicy" "Fixed Fixed"
"layoutAlignment" "AlignCenter"
"dashclr"N "_Transparent"
"antiAliased" "0"
E E 0 1 1 0 1 E U  1 E 112 213 178 229
1 2 0 "0s" 0 0 0 64 0 0  112 213 1
4
LANG:10001 32 Courier New,-1,12,5,50,0,0,0,0,0
LANG:10004 32 Courier New,-1,12,5,50,0,0,0,0,0
LANG:10000 32 Courier New,-1,12,5,50,0,0,0,0,0
LANG:10027 32 Courier New,-1,12,5,50,0,0,0,0,0
0 4
LANG:10001 0 
LANG:10004 0 
LANG:10000 0 
LANG:10027 0 
2 50
"Text7"
""
1 1365 295 E E E 1 E 1 E N "_3DText" E N "_3DFace" E E
 E E
48 0 0 0 0 0
E E E
0
3
LANG:10000 0 
LANG:10001 0 
LANG:10027 0 

4
"sizePolicy" "Fixed Fixed"
"layoutAlignment" "AlignCenter"
"dashclr"N "_Transparent"
"antiAliased" "0"
E E 0 1 1 0 1 E U  1 E 584 13 608 27
0 2 0 "0s" 0 0 0 192 0 0  584 13 1
4
LANG:10001 26 Arial,-1,13,5,50,0,0,0,0,0
LANG:10004 26 Arial,-1,13,5,50,0,0,0,0,0
LANG:10000 26 Arial,-1,13,5,50,0,0,0,0,0
LANG:10027 26 arial,-1,13,5,50,0,0,0,0,0
0 4
LANG:10001 4 Bits
LANG:10004 4 Bits
LANG:10000 4 Bits
LANG:10027 8 Биты
17 29
"Slaves"
""
1 25 31 E E E 1 E 1 E N "_WindowText" E N "_Window" E E
 E E
29 0 0 0 0 0
E E E
0
3
LANG:10000 0 
LANG:10001 0 
LANG:10027 0 

1
"layoutAlignment" "AlignCenter"
4
LANG:10001 26 Arial,-1,13,5,50,0,0,0,0,0
LANG:10004 26 Arial,-1,13,5,50,0,0,0,0,0
LANG:10000 26 Arial,-1,13,5,50,0,0,0,0,0
LANG:10027 26 arial,-1,13,5,50,0,0,0,0,0
0  23 29 167 204
0

"main()
{
dyn_string name,clean;
int cnt;
string slave,temp;


name = dpNames(\"_?_DP_*\");

    for (cnt=1;cnt <= dynlen(name);cnt++)
     {
      clean = strsplit(name[cnt],\":\");
      name[cnt]= clean[2];
     }

    for (cnt=1;cnt <= dynlen(name);cnt++)
     {
      slave = name[cnt];
      this.appendItem(slave);
     }

}
" 0

"main()
{
  string actbyte, hwname, text, val;
  int len, pos, bval, dlen, slot, extra;
  bool input, output, stdformat, consistency, bytes;
  blob conf;
  dyn_string hardname;
  string fdl;
  
  Modules.deleteAllItems;
  Daten.deleteAllItems;
  SubDaten.deleteAllItems;
  dpGet(this.selectedText+\".Data.Config:_original.._value\",conf) ;
  AllMod.text = conf;
  fdl = this.selectedText;
  hardname = strsplit(fdl,\"_\");  
  
  fdl = hardname[4];
    
  val = conf;
  len = strlen(val);
  slot = pos = 0;
  while (pos < len)
  {
    actbyte = substr(val,pos,2);
    pos += 2;
    sscanf(actbyte,\"%x\",bval);

    input = output = consistency = false;
    bytes = stdformat = true;
    hwname = fdl + \"D_\" + slot;
    slot ++;
    if (bval != 0) 
	    {
	    if (bval & 0x10) input = true;
	    if (bval & 0x20) output = true;
	
	    if (!input && !output) stdformat = true;
	
	    // stdformat
	    if (stdformat)
	    {
	      dlen = bval & 0x0F;
	      dlen ++;
	      if (bval & 0x40) bytes = false;
	      if (bval & 0x80) consistency = true;
	
	      if (input)
	      {
	        text = getCatStr(\"profibus\",\"eingang\") + dlen;
	        if (bytes) text += getCatStr(\"profibus\",\"8bitDigital\");
	        else text += getCatStr(\"profibus\",\"wAnalog\") ;
	        if (consistency) text += getCatStr(\"profibus\",\"bWconsist\");
	        else text += getCatStr(\"profibus\",\"fullConsist\");
	        ftext(hwname,text);
	 
	      } // input
	      if (output)
	      {
	        if (input) hwname += \"a\";
	
	        text = getCatStr(\"profibus\",\"ausgang\") + dlen;
	        if (bytes) text += getCatStr(\"profibus\",\"8bitDigital\");
	        else text += getCatStr(\"profibus\",\"wAnalog\");
	        if (consistency) text += getCatStr(\"profibus\",\"bWconsist\");
	        else text += getCatStr(\"profibus\",\"fullConsist\");
	        ftext(hwname,text);
	 
	      } // Output
	    } // end stdformat
	
	    // extra format
	    else
	    {
	      extra = bval & 0x0F;
	      if (extra == 15) extra = 0;
	      if (bval & 0x40) bytes = false;
	      if (bval & 0x80) consistency = true;
	
	      if (input)
	      {
	        actbyte = substr(val,pos,2);
	        pos += 2;
	        sscanf(actbyte,\"%x\",bval);
	
	        dlen = bval & 0x3F;
	        dlen ++;
	        if (bval & 0x40) bytes = false;
	        if (bval & 0x80) consistency = true;
	
	        text = \"IN : \" + dlen;
	        if (bytes) text += getCatStr(\"profibus\",\"8bitDigital\");
	        else text += getCatStr(\"profibus\",\"wAnalog\");
	        if (consistency) text += getCatStr(\"profibus\",\"bWconsist\");
	        else text += getCatStr(\"profibus\",\"fullConsist\");
	        ftext(hwname,text);
	      } // input
	      
	      
	      if (output)
	      {
	        if (input) hwname += \"a\";
	
	        actbyte = substr(val,pos,2);
	        pos += 2;
	        sscanf(actbyte,\"%x\",bval);
	
	        dlen = bval & 0x3F;
	        dlen ++;
	        if (bval & 0x40) bytes = false;
	        if (bval & 0x80) consistency = true;
	
	        text = \"OUT: \" + dlen;
	        if (bytes) text += getCatStr(\"profibus\",\"8bitDigital\");
	        else text += getCatStr(\"profibus\",\"wAnalog\") ;
	        if (consistency) text += getCatStr(\"profibus\",\"bWconsist\");
	        else text += getCatStr(\"profibus\",\"fullConsist\");
	
	        ftext(hwname,text);
	      }// output
	     
	      pos += 2*extra;	// vendor specific extra info
	    } // end extra format
       } // != 0
       else
       {
       text = getCatStr(\"profibus\",\"leer\");
       ftext(hwname,text);	  
	   
	   } 
	  extra = bval & 0x30;
	  if (extra == 0 && bval != 0 )
	   {
	   text = getCatStr(\"profibus\",\"idn\");
       ftext(hwname,text);  
	   }
	  
	  } // while
	  

}

ftext( string hwn, string txt)
{
     Modules.appendItem =hwn+\" \"+txt;
}

//Function Button6_EventClick()" 0

E

0 0
13 32
"Button4"
""
1 791 421 E E E 1 E 1 E N "_ButtonText" E N "_Button" E E
 E E
32 0 0 0 0 0
E E E
0
3
LANG:10000 0 
LANG:10001 0 
LANG:10027 0 

1
"layoutAlignment" "AlignCenter"
4
LANG:10001 26 Arial,-1,13,5,50,0,0,0,0,0
LANG:10004 26 Arial,-1,13,5,50,0,0,0,0,0
LANG:10000 26 Arial,-1,13,5,50,0,0,0,0,0
LANG:10027 26 arial,-1,13,5,50,0,0,0,0,0
0  469 209 563 243

T 
4
LANG:10001 6 Accept
LANG:10004 6 应用
LANG:10000 11 Übernehmen
LANG:10027 18 Применить
"main()
{
string asel,bsel,csel,dsel,conv,reference;
int anum, bnum, cnum, dnum, subindex, num, datatype, direction,driver;
dyn_string split;
string result;
dyn_string ds;
dyn_float df;


asel = Slaves.selectedText;
bsel = Modules.selectedText;
csel = Daten.selectedText;
dsel = SubDaten.selectedText;


if ( (asel == \"\")||(bsel == \"\")||(csel == \"\") ) 
  { // nothing really selected
   datatype = -1;  
   ChildPanelOnCentralModal(\"vision/MessageInfo1\",
   \"\",
   makeDynString(\"$1:\" + getCatStr(\"profibus\",\"nogoodsel\")));
  }
else 
  { 
      //all selected ok 
      
      // calculate subindex in Bytes
      if (strpos(csel,\"Byte\") >= 0)
        {
         if (dsel != \"\")
           {        
            split = strsplit(csel,\" \");
            conv = split[2];     
            subindex = conv;
            subindex = subindex * 8;
            split = strsplit(dsel,\" \");
            conv = split[2];
            num = conv;
            datatype = 0;
            subindex += num;
           }
         else
           {
            datatype = -2;     
            ChildPanelOnCentralModal(\"vision/MessageInfo1\",
            \"\",
            makeDynString(\"$1:\" + getCatStr(\"profibus\",\"nobisel\")));
           }
           
        }
      else
        {//words selected for calculation        
         split = strsplit(csel,\" \");
         conv = split[2];     
         datatype = 1;
         subindex = conv;
       
        }
      // now get reference
      split = strsplit(bsel,\" \");   
      reference = split[1];
      // and direction
   
      direction = 1;
      if (strpos(bsel,\"IN\") >= 0) direction = 0;
      // get driver num 
      split = strsplit(asel,\"_\");
      conv = split[2];     
      driver = conv;
 
   
 
 
      df = makeDynFloat(subindex,direction,datatype,driver);
      ds = makeDynString(reference);   
      dpSet(myUiDpName()+ \".ReturnValue.Float:_original.._value\",df);
      dpSet(myUiDpName()+ \".ReturnValue.Text:_original.._value\",ds);

      PanelOff();
      
   } // else ok  
}


//fail(string text)
//{
//
//}
" 0
 E E E
17 41
"Modules"
""
1 335 144 E E E 1 E 1 E N "_WindowText" E N "_Window" E E
 E E
41 0 0 0 0 0
E E E
0
3
LANG:10000 0 
LANG:10001 0 
LANG:10027 0 

1
"layoutAlignment" "AlignCenter"
4
LANG:10001 26 Arial,-1,13,5,50,0,0,0,0,0
LANG:10004 26 Arial,-1,13,5,50,0,0,0,0,0
LANG:10000 26 Arial,-1,13,5,50,0,0,0,0,0
LANG:10027 26 arial,-1,13,5,50,0,0,0,0,0
0  173 28 482 204
0

E
"main()
{
int sel,num,typ,dlen,cnt;
string seltx,trf;
dyn_string divide;
bool inp,outp,word,consist;


// Calculate what we have here
sel = this.selectedPos;
seltx = this.selectedText;
divide = strsplit(seltx,\"_\");
seltx = divide[2];
divide = strsplit(seltx,\" \");
seltx = divide[1];
SelMod.text = seltx;

if (strpos(seltx,\"a\") >= 0)
  {// Selection is Outputs
  
  num = strrtrim(seltx,\"a\");   
  }
else  
  {// Selection is  Inputs
  
  num = seltx;
  }
  
trf = AllMod.text;
trf = substr (trf,num*2,2);

sscanf(trf,\"%x\",typ);

   
consist = word = inp = outp = false;
   
   dlen = 1;
   
   if ((typ & 0x80) !=0 ) consist = true;
   if ((typ & 0x40) !=0 ) word = true;
   if ((typ & 0x20) !=0 ) outp = true;
   if ((typ & 0x10) !=0 ) inp = true;
   if ((typ & 0x08) !=0 ) dlen += 8;
   if ((typ & 0x04) !=0 ) dlen += 4;
   if ((typ & 0x02) !=0 ) dlen += 2;
   if ((typ & 0x01) !=0 ) dlen += 1;
  
Daten.deleteAllItems;
SubDaten.deleteAllItems;

if (typ != 0)
  {
   
    for (cnt = 0; cnt < dlen; cnt++)
       {
        if (!word) Daten.appendItem = \"Byte \" + cnt;
           
        else Daten.appendItem = \"Word \" + cnt; 
       }  
     
    
  }

}//main
" 0

E

0 0
13 42
"Button1"
""
1 1501 626 E E E 1 E 1 E N "_ButtonText" E N "_Button" E E
 E E
41 0 0 0 0 0
E E E
0
3
LANG:10000 0 
LANG:10001 0 
LANG:10027 0 

1
"layoutAlignment" "AlignCenter"
4
LANG:10001 26 Arial,-1,13,5,50,0,0,0,0,0
LANG:10004 26 Arial,-1,13,5,50,0,0,0,0,0
LANG:10000 26 Arial,-1,13,5,50,0,0,0,0,0
LANG:10027 26 arial,-1,13,5,50,0,0,0,0,0
0  569 209 663 243

T 
4
LANG:10001 6 Cancel
LANG:10004 6 取消
LANG:10000 7 Abbruch
LANG:10027 14 Удалить
"// SimpleCtrlScriptStart {invalid}
main()
{
  EP_panelOff();
}

EP_panelOff()
{
    dyn_float df;
    dyn_string ds; 
    
    df = makeDynFloat(0);
    ds = makeDynString(\"\");   
    dpSet(myUiDpName()+ \".ReturnValue.Float:_original.._value\",df);
    dpSet(myUiDpName()+ \".ReturnValue.Text:_original.._value\",ds);
  PanelOff();
}

// SimpleCtrlScript {EP_panelOff}
// Function {PanelOff}
// Panel {}
// Module {}
// SimpleCtrlScriptEnd {EP_panelOff}
" 0
 E E E
17 45
"Daten"
""
1 826 202 E E E 1 E 1 E N "_WindowText" E N "_Window" E E
 E E
43 0 0 0 0 0
E E E
0
3
LANG:10000 0 
LANG:10001 0 
LANG:10027 0 

1
"layoutAlignment" "AlignCenter"
4
LANG:10001 26 Arial,-1,13,5,50,0,0,0,0,0
LANG:10004 26 Arial,-1,13,5,50,0,0,0,0,0
LANG:10000 26 Arial,-1,13,5,50,0,0,0,0,0
LANG:10027 26 arial,-1,13,5,50,0,0,0,0,0
0  489 27 572 203
0

E
"main()
{
string txt;
int cnt; 
txt = this.selectedText;

SubDaten.deleteAllItems;

//SubDaten.appendItem = \"Bits 0..7\";

if (strpos(txt,\"Byte\") >= 0) 
  {
    for ( cnt = 0; cnt <= 7; cnt++) SubDaten.appendItem = \"Bit \" + cnt;
  }

     
}" 0

E

0 0
17 49
"SubDaten"
""
1 1408 259 E E E 1 E 1 E N "_WindowText" E N "_Window" E E
 E E
47 0 0 0 0 0
E E E
0
3
LANG:10000 0 
LANG:10001 0 
LANG:10027 0 

1
"layoutAlignment" "AlignCenter"
4
LANG:10001 26 Arial,-1,13,5,50,0,0,0,0,0
LANG:10004 26 Arial,-1,13,5,50,0,0,0,0,0
LANG:10000 26 Arial,-1,13,5,50,0,0,0,0,0
LANG:10027 26 arial,-1,13,5,50,0,0,0,0,0
0  580 26 662 202
0

E
E
E

0 0
0
LAYER, 1 
4
LANG:10001 6 Layer2
LANG:10004 6 Layer2
LANG:10000 6 Layer2
LANG:10027 6 Layer2
0
LAYER, 2 
4
LANG:10001 6 Layer3
LANG:10004 6 Layer3
LANG:10000 6 Layer3
LANG:10027 6 Layer3
0
LAYER, 3 
4
LANG:10001 6 Layer4
LANG:10004 6 Layer4
LANG:10000 6 Layer4
LANG:10027 6 Layer4
0
LAYER, 4 
4
LANG:10001 6 Layer5
LANG:10004 6 Layer5
LANG:10000 6 Layer5
LANG:10027 6 Layer5
0
LAYER, 5 
4
LANG:10001 6 Layer6
LANG:10004 6 Layer6
LANG:10000 6 Layer6
LANG:10027 6 Layer6
0
LAYER, 6 
4
LANG:10001 6 Layer7
LANG:10004 6 Layer7
LANG:10000 6 Layer7
LANG:10027 6 Layer7
0
LAYER, 7 
4
LANG:10001 6 Layer8
LANG:10004 6 Layer8
LANG:10000 6 Layer8
LANG:10027 6 Layer8
0
0
